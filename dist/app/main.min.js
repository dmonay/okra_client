!function(){"use strict";angular.module("SharedFactories",[]),angular.module("HeaderModule",[]),angular.module("OrganizationModule",[]),angular.module("TreeModule",[]),angular.module("LoginModule",[]),angular.module("SharedServices",[]),angular.module("SharedDirectives",[]),angular.module("SharedFilters",[]);var a=["ui.router","ngAnimate","ipCookie","ngAria","ngMaterial","okra.templates","HeaderModule","LoginModule","OrganizationModule","TreeModule","SharedFactories","SharedServices","SharedDirectives","SharedFilters","okra.routes"],b=angular.module("okra",a);angular.element(document).ready(function(){-1===document.body.className.indexOf("ng-app")&&(angular.bootstrap(document,["okra"]),document.body.className=document.body.className+" ng-app")}),b.config(["$mdThemingProvider",function(a){var b=a.extendPalette("green",{500:"#99b742"});a.definePalette("okraGreen",b),a.theme("default").primaryPalette("okraGreen")}]),b.run(["$http","$location","$rootScope","$state","$window","session",function(a,b,c,d,e,f){a.get("app/bootstrap.json").success(function(a){f.storeCredentials(a)}),e.isAuthenticated=function(){f.isAuthenticated()},c.$on("$stateChangeSuccess",function(){"login"==d.current.name||f.user||d.go("login")}),c.$on("$stateChangeStart",function(){"login"!=d.current.name&&f.user&&d.go(d.current.name)})}]),b.constant("okraAPI",{registerUser:"https://evening-river-9352.herokuapp.com/create/register",createOrg:"https://evening-river-9352.herokuapp.com/create/organization",updateMission:"https://evening-river-9352.herokuapp.com/update/mission/",updateMembers:"https://evening-river-9352.herokuapp.com/update/members/",getOrganizations:"https://evening-river-9352.herokuapp.com/get/orgs/all/",createTree:"https://evening-river-9352.herokuapp.com/create/tree/",getTreesInOrg:"https://evening-river-9352.herokuapp.com/get/trees/",getSingleTreeInOrg:"https://evening-river-9352.herokuapp.com/get/trees/",createObjective:"https://evening-river-9352.herokuapp.com/create/objective/",updateObjective:"https://evening-river-9352.herokuapp.com/update/objective/properties/",createKeyResult:"https://evening-river-9352.herokuapp.com/create/kr/",updateKeyResult:"https://evening-river-9352.herokuapp.com/update/kr/properties/",createTask:"https://evening-river-9352.herokuapp.com/create/task/",updateTask:"https://evening-river-9352.herokuapp.com/update/task/properties/"}),b.constant("hardCoded",{userId:"54d55f11673e6cfceef7e097",userName:"someuser123"}),b.constant("jsPlumbDefaults",{PaintStyle:{lineWidth:3,strokeStyle:"#99b742",outlineWidth:1},EndpointStyle:{fillStyle:"#99b742",radius:4},Connector:["Bezier",{curviness:20}],Anchors:["BottomCenter","TopCenter"]})}(),function(){"use strict";var a=angular.module("okra.routes",["ui.router"]);a.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/404"),a.state("404",{url:"/404",templateUrl:"app/shared/404.tpl.html"}).state("login",{url:"/",templateUrl:"app/login/login.tpl.html",controller:"LoginController as vm"}).state("organization/tree",{url:"/organization/:organization/tree/:treeIdEnc",templateUrl:"app/tree/tree.tpl.html",controller:"TreeController as vm"}).state("organization",{url:"/organization/:organization/trees",templateUrl:"app/organization/organization-trees-selection.tpl.html",controller:"OrganizationController as vm"}).state("organizations",{url:"/organizations",templateUrl:"app/organization/organization-selection.tpl.html",controller:"OrganizationSelectionController as vm"})}])}(),function(){"use strict";function a(a,b,c,d){var e=this;e.userName=c.userName,e.session=d,e.dropdownOpen=!1}var b=angular.module("HeaderModule");a.$inject=["$scope","$mdDialog","hardCoded","session","$interval"],b.controller("HeaderController",a)}(),function(){"use strict";function a(a){var b=this;b.googleLogin=function(){a.gAuthenticate(!1)}}var b=angular.module("LoginModule");a.$inject=["session"],b.controller("LoginController",a)}(),function(){"use strict";function a(a,b,c){var d=this;d.createOrganization=function(a){d.formSubmitted=!0,d.organizationForm.$valid&&b.createOrganization(a).then(function(a){c.hide(a)})},d.closeModal=function(){c.hide()}}var b=angular.module("HeaderModule");a.$inject=["$scope","OrganizationFactory","$mdDialog"],b.controller("AddOrganizationModalController",a)}(),function(){"use strict";function a(a,b,c,d,e){var f=this;f.timeframe="monthly",f.formSubmitted=!1,f.addTree=function(){if(f.formSubmitted=!0,f.addTreeForm.$valid){f.currentlySaving=!0;var a={name:f.newTreeName,timeframe:f.timeframe,userId:d.userId,username:d.userName};b.createTree(e,a).then(function(a){f.currentlySaving=!1,f.formSubmitted=!1,c.hide(a.data)})}},f.closeModal=function(){c.hide()}}var b=angular.module("OrganizationModule");a.$inject=["$scope","TreeFactory","$mdDialog","hardCoded","organization"],b.controller("AddTreeModalController",a)}(),function(){"use strict";function a(a,b,c,d,e){var f=this;f.organization=d.organization,f.linkedNodeIds=["organizationNode","objectiveNode","keyResultNode","taskNode"],c.getTrees(f.organization).then(function(a){f.trees=c.formatTrees(a.data.Success)}),f.openOrganizationMembersModal=function(a){b.show({targetEvent:a,templateUrl:"app/shared/members-modal/members-modal.tpl.html",controller:"MembersModalController",controllerAs:"modal",locals:{members:f.orgMembers,apiFactory:e,node:f.organization}}).then(function(a){f.orgMembers=a})},f.openAddTreeModal=function(a){b.show({targetEvent:a,templateUrl:"app/organization/add-tree-modal.tpl.html",controller:"AddTreeModalController",controllerAs:"modal",locals:{organization:f.organization}}).then(function(a){a&&!a.Error&&(f.formattedTrees=angular.copy(f.trees),f.formattedTrees.push(a.Success),f.formattedTrees=_.flatten(f.formattedTrees),f.trees=c.formatTrees(f.formattedTrees))})}}var b=angular.module("OrganizationModule");a.$inject=["$scope","$mdDialog","TreeFactory","$stateParams","OrganizationFactory"],b.controller("OrganizationController",a)}(),function(){"use strict";function a(a,b,c,d,e){function f(){c.getOrganizations(d.userId).then(function(a){h.organizations=e.formatTrees(a.data.Success)})}function g(){f()}var h=this;h.addOrganization=function(a){b.show({targetEvent:a,templateUrl:"app/organization/add-organization-modal.tpl.html",controller:"AddOrganizationModalController",controllerAs:"modal"}).then(function(a){a&&f()})},g()}var b=angular.module("OrganizationModule");a.$inject=["$scope","$mdDialog","OrganizationFactory","hardCoded","TreeFactory"],b.controller("OrganizationSelectionController",a)}(),function(){"use strict";function a(a,b,c){var d={createOrganization:function(d){return a.post(b.createOrg,{organization:d,userId:c.userId})},updateMission:function(c,d){var e=b.updateMission+c;return a.post(e,{mission:d,treeId:"549dcbe9efb6f7204b000001"})},updateMembers:function(c,d){var e=b.updateMembers+c;return a.post(e,{updateTree:!1,members:d})},getOrganizations:function(c){var d=b.getOrganizations+c;return a.get(d)}};return d}var b=angular.module("SharedFactories");a.$inject=["$http","okraAPI","hardCoded"],b.factory("OrganizationFactory",a)}(),function(){"use strict";function a(){return{restrict:"A",templateUrl:"app/organization/organization-summary-widget.tpl.html"}}var b=angular.module("SharedDirectives");b.directive("organizationSummaryWidget",a)}(),function(){"use strict";var a=angular.module("SharedFilters");a.filter("okDecrypt",function(){return function(a){var b=CryptoJS.AES.decrypt(a,"DPokraPC");return b.toString(CryptoJS.enc.Utf8)}})}(),function(){"use strict";function a(){return function(a){var b=CryptoJS.AES.encrypt(a,"DPokraPC");return b.toString()}}var b=angular.module("SharedFilters");b.filter("okEncrypt",a)}(),function(){"use strict";function a(a,b,c,d,e,f){var g=this;g.members=d,g.newUser={role:"member"},g.addMember=function(){if(g.formSubmitted=!0,g.newMemberForm.$valid){g.currentlySaving=!0;var a=[],d=e.createUser(g.newUser.name,g.newUser.role);a.push(d),b.updateMembers(f,a).then(function(){g.currentlySaving=!1,g.formSubmitted=!1,c.hide(d)})}},g.closeModal=function(){c.hide()}}var b=angular.module("OrganizationModule");a.$inject=["$scope","apiFactory","$mdDialog","members","MemberService","node"],b.controller("MembersModalController",a)}(),function(){"use strict";function a(){function a(a,b){this.userName=a,this.role=b}var b={createUser:function(b,c){return new a(b,c)}};return b}var b=angular.module("SharedServices");b.factory("MemberService",a)}(),function(){"use strict";function a(b,c,d,e,f,g){var h={};return h.gAuthenticate=function(b){(new Date).getTime(),1e3*g("okTokenExpirationDate");gapi.client.setApiKey(h.authCreds.gApiKey),gapi.auth.authorize({client_id:h.authCreds.gauthClientId,scope:"https://www.googleapis.com/auth/userinfo.profile",immediate:b}).then(function(c){c.access_token&&(a.auth={accessToken:c.access_token,tokenLifespan:c.expires_in},g("okSession",c.access_token),g("okTokenExpirationDate",c.expires_at),h.getProfile(b))},function(){console.log("Silent login failed")})},h.getProfile=function(a){gapi.client.load("plus","v1").then(function(){var b=gapi.client.plus.people.get({userId:"me"});b.then(function(b){h.user=b.result,"login"==c.current.name&&c.go("organizations"),a||e.show(e.simple().content("Welcome "+h.user.displayName).position("top right").hideDelay(3e3)),h.beginAuthCountdown(24e5)},function(a){"401"===a.error&&h.gAuthenticate(!0)})})},h.updateUser=function(){b.post(f.registerUser,{userName:a.user.displayName})},h.beginAuthCountdown=function(a){h.authCountdown=d(function(){h.gAuthenticate(!0)},a)},h.storeCredentials=function(a){h.authCreds={gauthClientId:a.gauthClientId,gApiKey:a.gApiKey}},h.isAuthenticated=function(){h.gAuthenticate(!0)},h.logOut=function(){d.cancel(h.authCountdown),c.go("login"),h.user=void 0},h}var b=angular.module("SharedServices");a.$inject=["$http","$state","$timeout","$mdToast","okraAPI","ipCookie"],b.factory("session",a)}(),function(){"use strict";function a(a){function b(b,c){var d=angular.element(document.getElementById(b.linkedTo)),e=b.allLinkedNodes;c.bind("click",function(){var c,f=d.next().hasClass("collapse"),g=e.indexOf(b.linkedTo)+1;for(g;g<e.length;g++)c=angular.element(document.getElementById(e[g])),e[g]===b.linkedTo||f||a.addClass(c,"collapse"),f||(a.addClass(c,"collapse"),a.removeClass(d.next(),"collapse"),d.next().children().removeClass("active")),f&&(a.removeClass(c,"collapse"),g=e.length),b.$apply()})}return{restrict:"A",link:b,scope:{linkedTo:"@",allLinkedNodes:"="}}}var b=angular.module("SharedDirectives");a.$inject=["$animate"],b.directive("okCollapse",a)}(),function(){"use strict";var a=angular.module("SharedDirectives");a.directive("okDrawConnection",["jsPlumbDefaults",function(a){function b(b,c,d){function e(a){var b=angular.element(document.getElementById(a)),c=b.attr("parent-id");c&&(jsPlumb.connect({source:c,target:a}),e(c))}var f=d.parentId;c.on("click",function(){jsPlumb.detachEveryConnection(f),c.parent().parent().children().removeClass("active"),c.hasClass("active")?c.parent().removeClass("active"):(c.parent().addClass("active"),jsPlumb.importDefaults(a),e(c.attr("id")),jsPlumb.draggable(c[0].id))})}return{restrict:"A",link:b}}])}(),angular.module("okra.templates",[]).run(["$templateCache",function(a){a.put("app/login/login.tpl.html",'<div class="green-overlay" layout="column" layout-align="center center" flex="100"><div layout="row" layout-align="center center"><img class="logo" src="assets/okra-logo-large.png"></div><div layout="row" layout-align="center center"><h1 class="slogan">An OKR management tool to keep your team on track.</h1></div><md-button class="md-raised md-warn" ng-click="vm.googleLogin()" aria-label="log in"><i class="fa fa-google"></i> Sign in with Google</md-button></div>'),a.put("app/organization/add-organization-modal.tpl.html",'<md-dialog flex="30"><div layout="row" layout-align="center"><md-subheader><h3>Add An Organization</h3></md-subheader></div><md-content><div layout="row" layout-align="center"><form class="form-horizontal" name="modal.organizationForm"><div layout="row" layout-align="center center"><div layout-align="start start"><md-input-container class="long"><label>Organization Name</label><md-input required name="organizationName" ng-model="modal.organizationName" autocapitalize="off"></md-input></md-input-container></div><div class="error-msg ng-hide" layout-align="center end" ng-show="modal.formSubmitted && modal.organizationForm.organizationName.$invalid" ng-cloak><i class="fa fa-warning"></i><md-tooltip>This field is required</md-tooltip></div></div></form></div><md-content><div class="md-actions" layout="row" layout-align="center end"><md-button class="md-raised md-warn" ng-click="modal.closeModal()" aria-label="cancel">Cancel</md-button><md-button class="md-raised md-primary" ng-click="modal.createOrganization(modal.organizationName)" aria-label="add">Add</md-button></div><md-dialog></md-dialog></md-content></md-content></md-dialog>'),a.put("app/organization/add-tree-modal.tpl.html",'<md-dialog flex="30"><div layout="row" layout-align="center"><md-subheader><h3>Add A Tree</h3></md-subheader></div><md-content><form class="form-horizontal" name="modal.addTreeForm"><div layout="row" layout-align="center center"><div layout-align="start start"><md-input-container class="long"><label>Tree Name</label><md-input required name="newTreeName" ng-model="modal.newTreeName" autocapitalize="off"></md-input></md-input-container></div><div class="error-msg ng-hide" layout-align="center end" ng-show="modal.formSubmitted && modal.addTreeForm.newTreeName.$invalid" ng-cloak><i class="fa fa-warning"></i><md-tooltip>This field is required</md-tooltip></div></div><div layout="row" layout-align="center center"><div layout-align="start start"><md-radio-group class="horizontal-radio-group" layout="row" ng-model="modal.timeframe"><md-radio-button value="monthly" aria-label="Monthly">Monthly</md-radio-button><md-radio-button value="yearly" artial-label="Yearly">Yearly</md-radio-button></md-radio-group></div></div></form><md-content><div class="md-actions" style="border-top: none" layout="row" layout-align="center end"><md-button class="md-raised md-warn" ng-click="modal.closeModal()" aria-label="cancel">Cancel</md-button><md-button class="md-raised md-primary" ng-click="modal.addTree()" aria-label="add">Add</md-button><md-progress-circular ng-if="modal.currentlySaving" md-mode="indeterminate" md-diameter="20"></md-progress-circular></div><md-dialog></md-dialog></md-content></md-content></md-dialog>'),a.put("app/organization/organization-selection.tpl.html",'<section class="organization-wrapper"><div layout-align="center center" layout="row"><h1>Organizations</h1></div><div class="centered-row" layout="row" layout-align="start center" ng-repeat="organizationRow in vm.organizations track by $index"><div class="organization" layout="row" layout-align="start center" ng-repeat="org in organizationRow track by $index"><a href class="tree-node" ui-sref="organization({ organization: org })">{{org}}<md-tooltip ng-if="org.length > 14">{{org}}</md-tooltip></a></div><div class="organization add-node" layout="row" layout-align="start center" ng-if="organizationRow.length < 4"><button class="tree-node" ng-click="vm.addOrganization()" aria-label="cancel"><div>Add</div><div>an Org. <i class="fa fa-plus"></i></div></button></div></div><div layout="row" layout-align="center center" class="disable-animations" ng-if="vm.organizations.length === 0 || !vm.organizations">New to Okra? That\'s alright.<md-button class="md-raised md-primary" ng-click="vm.addOrganization()" aria-label="cancel">Create an Organization <i class="fa fa-plus"></i></md-button></div></section>'),a.put("app/organization/organization-summary-widget.tpl.html",'<div class="organization-widget"><img class="logo" src="http://img4.wikia.nocookie.net/__cb20140723203502/thehungergames/images/b/b9/House_stark_by_azraeuz-d61daf1.png"><div class="org-name">{{vm.organization}}</div><div><md-button class="md-raised" aria-label="members">Members</md-button></div></div>'),a.put("app/organization/organization-trees-selection.tpl.html",'<section class="organization-wrapper"><div class="organization active" style="margin-bottom: 5px" layout="row" layout-align="center" id="organizationNode"><div class="tree-node">{{vm.organization}}</div><div layout="column" layout-align="start end"><md-button class="md-raised md-primary" ng-click="vm.openOrganizationMembersModal()" aria-label="members"><i class="fa fa-users"></i></md-button></div></div><div layout="column" id="treesNode"><div class="centered-row" layout="row" layout-align="start center" ng-repeat="treeRow in vm.trees track by $index"><div class="tree" layout="row" layout-align="start" ng-repeat="tree in treeRow track by $index"><a class="tree-node" ng-hide="tree.isEditMode" ui-sref="organization/tree({ treeIdEnc: (tree.Id | okEncrypt), organization: vm.organization })">{{tree.Name}}<md-tooltip ng-if="tree.Name.length > 14">{{tree.Name}}</md-tooltip></a></div><div class="tree add-node" layout-align="start" ng-if="treeRow.length < 4"><button href class="tree-node" ng-click="vm.openAddTreeModal()" ng-click="vm.openAddTreeModal()" aria-label="Add Tree"><div>Add</div><div>A Tree <i class="fa fa-plus"></i></div></button></div></div><div class="centered-row" ng-if="vm.trees.length === 0" layout="row" layout-align="start center"><div class="tree add-node" layout-align="start"><button href class="tree-node" ng-click="vm.openAddTreeModal()" ng-click="vm.openAddTreeModal()" aria-label="Add Tree"><div>Add</div><div>A Tree <i class="fa fa-plus"></i></div></button></div></div></div></section>'),a.put("app/shared/404.tpl.html",'<div class="error-not-found" layout="column" align="center center"><img src="assets/okra-404.jpg"><h1>That\'s Strange...</h1><h2>Probably not what you were looking for right?</h2></div>'),a.put("app/shared/members-modal/members-modal.tpl.html",'<md-dialog flex="50"><div layout="row" layout-align="center"><md-subheader><h3>Members</h3></md-subheader></div><div layout="row" layout-align="start center"><ul class="list-horizontal"><li ng-repeat="member in modal.members"><h3>{{member.userName}}</h3><span class="sub-text">{{member.role}}</span></li></ul></div><md-content><form class="form-horizontal" name="modal.newMemberForm"><div layout="row" layout-align="center center"><div layout-align="start start"><md-input-container class="long"><label>Username</label><md-input required name="newUserName" ng-model="modal.newUser.name" autocapitalize="off"></md-input></md-input-container></div><div class="error-msg ng-hide" layout-align="center end" ng-show="modal.formSubmitted && modal.newMemberForm.newUserName.$invalid" ng-cloak><i class="fa fa-warning"></i><md-tooltip>This field is required</md-tooltip></div></div><div layout="row" layout-align="center center"><div layout-align="start start"><md-radio-group class="horizontal-radio-group" layout="row" ng-model="modal.newUser.role"><md-radio-button value="member" aria-label="Member">Member</md-radio-button><md-radio-button value="admin" artial-label="Admin">Admin</md-radio-button></md-radio-group></div></div></form><md-content><div class="md-actions" style="border-top: none" layout="row" layout-align="center center"><md-button class="md-raised md-warn" ng-click="modal.closeModal()" aria-label="cancel">Close</md-button><md-button class="md-raised md-primary" ng-click="modal.addMember()" aria-label="add">Add Member</md-button><md-progress-circular ng-if="modal.currentlySaving" md-mode="indeterminate" md-diameter="20"></md-progress-circular></div><md-dialog></md-dialog></md-content></md-content></md-dialog>'),a.put("app/tree/mission-statement-modal.tpl.html",'<md-dialog flex="30"><div layout="row" layout-align="center"><md-subheader><h3>Mission Statement</h3></md-subheader></div><div layout="row" layout-align="center center">{{modal.missionStatement}}</div><md-content><form class="form-horizontal" name="modal.missionStatementForm"><div layout="row" layout-align="center center"><div layout-align="start start"><md-input-container class="long"><label>New Mission Statement</label><md-input required name="newMissionStatement" ng-model="modal.newMissionStatement" autocapitalize="off"></md-input></md-input-container></div><div class="error-msg ng-hide" layout-align="center end" ng-show="modal.formSubmitted && modal.missionStatementForm.newMissionStatement.$invalid" ng-cloak><i class="fa fa-warning"></i><md-tooltip>This field is required</md-tooltip></div></div></form><md-content><div class="md-actions" style="border-top: none" layout="row" layout-align="center end"><md-button class="md-raised md-warn" ng-click="modal.closeModal()" aria-label="cancel">Cancel</md-button><md-button class="md-raised md-primary" ng-click="modal.saveMissionStatement()" aria-label="add">Save</md-button><md-progress-circular ng-if="modal.currentlySaving" md-mode="indeterminate" md-diameter="20"></md-progress-circular></div><md-dialog></md-dialog></md-content></md-content></md-dialog>'),a.put("app/tree/node-modal-dashboard.tpl.html",'<md-dialog flex="30"><div layout="row" layout-align="center" ng-class="{completed: modal.node.Completed === true}"><md-subheader><h3><span ng-if="!modal.editMode">Create</span> {{modal.name}}</h3></md-subheader></div><md-content><form class="form-horizontal" name="modal.nodeForm"><div layout="row" layout-align="center center"><div layout-align="start start" flex="100"><md-input-container flex><label>Name</label><md-input required name="nodeName" md-maxlength="30" ng-model="modal.node.Name" autocapitalize="off"></md-input></md-input-container></div><div class="error-msg ng-hide" layout-align="center end" ng-show="modal.formSubmitted && modal.nodeForm.nodeName.$invalid" ng-cloak><i class="fa fa-warning"></i><md-tooltip>This field is required</md-tooltip></div></div><div layout="row" layout-align="center center"><div layout-align="start start" flex="100"><md-input-container flex><label>Description</label><textarea required name="nodeBody" ng-model="modal.node.Body" columns="1" md-maxlength="150"></textarea></md-input-container></div><div class="error-msg ng-hide" layout-align="center end" ng-show="modal.formSubmitted && modal.nodeForm.nodeBody.$invalid" ng-cloak><i class="fa fa-warning"></i><md-tooltip>This field is required</md-tooltip></div></div><div layout="row" layout-align="center center"><div layout-align="start start" layout="row" flex="100"><md-checkbox class="horizontal-checkbox" ng-change="modal.addMember(member, member.isChecked)" ng-model="member.isChecked" aria-label="{{member.userName}}" ng-repeat="member in modal.members">{{member.userName}}</md-checkbox></div></div><div layout="row" layout-align="center center" ng-if="modal.nodeType === \'Key Result\' || modal.nodeType === \'Task\'"><div layout-align="start-start" layout="row" flex="100"><md-switch ng-model="modal.node.Priority" aria-label="Priority" ng-true-value="\'High\'" ng-false-value="\'Low\'" class="md-warn">{{modal.node.Priority}} Priority</md-switch></div></div><div layout="row" layout-align="center center"><md-checkbox ng-model="modal.node.Completed" aria-label="completed">Completed?</md-checkbox></div></form><md-content><div class="md-actions" style="border-top: none" layout="row" layout-align="center end"><md-button class="md-raised md-warn" ng-click="modal.closeModal()" aria-label="cancel">Cancel</md-button><md-button ng-if="!modal.editMode" class="md-raised md-primary" ng-click="modal.createNode()" aria-label="add">Create</md-button><md-button ng-if="modal.editMode" class="md-raised md-primary" ng-click="modal.updateNode()" aria-label="add">Save</md-button><md-progress-circular ng-if="modal.currentlySaving" md-mode="indeterminate" md-diameter="20"></md-progress-circular></div><md-dialog></md-dialog></md-content></md-content></md-dialog>'),a.put("app/tree/tree.tpl.html",'<section class="organization-wrapper"><div organization-summary-widget></div><div class="tree active" layout="row" layout-align="center" id="organizationNode"><button class="tree-node" id="treeNode" ok-collapse linked-to="organizationNode" all-linked-nodes="vm.linkedNodeIds">{{vm.tree.TreeName}}<md-tooltip ng-if="vm.tree.TreeName.length > 14">{{vm.tree.TreeName}}</md-tooltip></button><div layout="column" layout-align="start end"><md-button href class="md-raised md-primary" aria-label="edit"><i class="fa fa-pencil"></i></md-button></div><div layout="column" layout-align="start end"><md-button class="md-raised md-primary" ng-click="vm.openTreeMembersModal()" aria-label="members"><i class="fa fa-users"></i></md-button><md-button class="md-raised md-primary" ng-click="vm.openMissionStatementModal()" aria-label="mission statement"><i class="fa fa-briefcase"></i></md-button></div></div><div layout="row" class="collapse" layout-align="center center" id="objectiveNode"><div class="objective" layout="row" layout-align="start" ng-repeat="objective in vm.tree.Objectives track by $index"><button class="tree-node" id="objective{{$index}}" ng-click="vm.changeCurrentObjective($index, objective)" layout-align="start" ok-collapse linked-to="objectiveNode" all-linked-nodes="vm.linkedNodeIds" ok-draw-connection parent-id="treeNode">{{objective.Name}}<md-tooltip ng-if="objective.Name.length > 14">{{objective.Name}}</md-tooltip><span class="status" ng-if="objective.Completed === true"><i class="fa fa-check"></i></span></button><div layout="column" layout-align="start end"><md-button href class="md-raised md-primary fade-in" ng-click="vm.openNodeModalDashboard($event, true, \'Objective\', objective, false, false)" aria-label="edit"><i class="fa fa-pencil"></i></md-button></div></div><div class="objective add-node" layout="row" layout-align="start" ng-if="vm.tree.Objectives.length !== 4"><button ng-click="vm.openNodeModalDashboard($event, false, \'Objective\', {}, false, false)" class="tree-node" layout-align="start"><div>Add</div><div>Objective <i class="fa fa-plus"></i></div></button></div></div><div layout="row" class="collapse" layout-align="center center" id="keyResultNode"><div class="key-result" layout="row" layout-align="start" ng-repeat="keyResult in vm.currentObjective.KeyResults track by $index"><button class="tree-node" id="keyResult{{$index}}" ng-class="{completed: keyResult.Completed === true}" ng-click="vm.changeCurrentKeyResult(keyResult)" ok-collapse linked-to="keyResultNode" all-linked-nodes="vm.linkedNodeIds" ok-draw-connection parent-id="{{vm.currentObjective.nodeId}}" aria-label="toggle">{{keyResult.Name}}<md-tooltip ng-if="keyResult.Name.length > 14">{{keyResult.Name}}</md-tooltip><span class="status" ng-if="keyResult.Completed === true"><i class="fa fa-check"></i></span> <span class="status" ng-if="!keyResult.Completed && keyResult.Priority === \'High\'"><md-tooltip>High Priority</md-tooltip><i class="fa fa-exclamation"></i></span></button><div layout="column" layout-align="start end"><md-button href class="md-raised md-primary fade-in" ng-click="vm.openNodeModalDashboard($event, true, \'Key Result\', keyResult, vm.currentObjective, false)" aria-label="edit"><i class="fa fa-pencil"></i></md-button></div></div><div class="key-result add-node" layout="row" layout-align="start" ng-if="vm.currentObjective.KeyResults.length !== 4"><button ng-click="vm.openNodeModalDashboard($event, false, \'Key Result\', {}, vm.currentObjective, false)" class="tree-node" layout-align="start"><div>Add</div><div>Key Result <i class="fa fa-plus"></i></div></button></div></div><div layout="column" class="collapse task-column" ok-collapse linked-to="taskNode" layout-align="space-around center" all-linked-nodes="vm.linkedNodeIds" id="taskNode"><div layout="row" layout-align="start center" ng-repeat="task in vm.currentKeyResult.Tasks"><md-checkbox ng-model="task.Completed" aria-label></md-checkbox><a href class="task-node" ng-click="vm.openNodeModalDashboard($event, true, \'Task\', task, vm.currentObjective, vm.currentKeyResult)">{{task.Name}} <span class="status" ng-if="!task.Completed && task.Priority === \'High\'"><md-tooltip>High Priority</md-tooltip><i class="fa fa-exclamation"></i></span></a></div><div class="task-row" layout="row" layout-align="start center" ng-if="vm.currentKeyResult.Tasks.length !== 9"><md-button ng-click="vm.openNodeModalDashboard($event, false, \'Task\', {}, vm.currentObjective, vm.currentKeyResult)" class="md-primary md-raised">Add Task <i class="fa fa-plus"></i></md-button></div></div></section>')}]),function(){"use strict";function a(a,b,c,d,e){var f=this;f.missionStatement=d,f.formSubmitted=!1,f.saveMissionStatement=function(){f.formSubmitted=!0,f.missionStatementForm.$valid&&(f.currentlySaving=!0,b.updateMission(e.org,f.newMissionStatement).then(function(a){f.currentlySaving=!1,f.formSubmitted=!1,c.hide(a.data)}))},f.closeModal=function(){c.hide()}}var b=angular.module("OrganizationModule");a.$inject=["$scope","OrganizationFactory","$mdDialog","missionStatement","hardCoded"],b.controller("MissionStatementModalController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){var j,k=this;k.editMode=d,k.nodeType=e,k.name=d?f.Name:e,k.formSubmitted=!1,k.members=angular.copy(g.Members),k.node=angular.copy(f),d?_.each(k.members,function(a,b){k.node.Members[b]&&k.node.Members[b].userName===a.userName&&(a.isChecked=!0)}):(k.node.Members=[],"Objective"===e&&(k.node.Id="obj"+(g.Objectives.length+1)),"Key Result"===e&&(k.node.Id="kr"+(h.KeyResults.length+1)),"Task"===e&&(k.node.Id="task"+(i.Tasks.length+1))),("Key Result"===e||"Task"===e)&&(k.node.Priority=f.Priority?f.Priority:"Low"),"Task"===e&&(j=i),k.createNode=function(){if(k.formSubmitted=!0,k.nodeForm.$valid){var a="create"+e.replace(" ","");b[a](g,k.node,h,j).then(function(a){a.data.Success&&c.hide({node:k.node,parentNode:h})})}},k.updateNode=function(){if(k.formSubmitted=!0,k.nodeForm.$valid){var a="update"+e.replace(" ","");b[a](g,k.node,h,j).then(function(a){a.data.Success&&c.hide({node:k.node,parentNode:h})})}},k.addMember=function(a,b){b?k.node.Members.push(a):k.node.Members=_.reject(f.Members,function(b){return b===a})},k.closeModal=function(){c.hide()}}var b=angular.module("TreeModule");a.$inject=["$scope","TreeFactory","$mdDialog","editMode","nodeType","node","tree","parentNode","secondaryParentNode"],b.controller("NodeModalDashboardController",a)}(),function(){"use strict";function a(a,b,c,d,e){function f(){c.getSingleTree(d.organization,j).then(function(a){i.tree=a.data.Success})}function g(a,b){return _.findIndex(a,function(a){return a.Id===b})}function h(){f()}jsPlumb.detachEveryConnection();var i=this,j=e("okDecrypt")(d.treeIdEnc);i.linkedNodeIds=["organizationNode","objectiveNode","keyResultNode","taskNode"],i.organization=d.organization,i.changeCurrentObjective=function(a,b){i.currentObjective=b,i.currentObjective.nodeId="objective"+a},i.changeCurrentKeyResult=function(a){i.currentKeyResult=a},i.openMissionStatementModal=function(a){b.show({targetEvent:a,templateUrl:"app/tree/mission-statement-modal.tpl.html",controller:"MissionStatementModalController",controllerAs:"modal",locals:{missionStatement:i.tree.Mission}}).then(function(a){i.tree.Mission=a})},i.openTreeMembersModal=function(a){b.show({targetEvent:a,templateUrl:"app/shared/members-modal/members-modal.tpl.html",controller:"MembersModalController",controllerAs:"modal",locals:{members:i.tree.Members,apiFactory:c,node:i.tree}}).then(function(a){a&&i.tree.Members.push(a)})},i.openNodeModalDashboard=function(a,c,d,e,f,h){b.show({targetEvent:a,templateUrl:"app/tree/node-modal-dashboard.tpl.html",controller:"NodeModalDashboardController",controllerAs:"modal",locals:{editMode:c,nodeType:d,node:e,tree:i.tree,parentNode:f,secondaryParentNode:h}}).then(function(a){if(a){var b=a.node,e=a.parentNode;if(c){var f;if("Objective"===d)f=g(i.tree.Objectives,b.Id),i.tree.Objectives[f].Name=b.Name,i.tree.Objectives[f].Body=b.Body,i.tree.Objectives[f].Completed=b.Completed;else if("Key Result"===d){var h=g(e.KeyResults,b.Id);f=g(i.tree.Objectives,e.Id),i.tree.Objectives[f].KeyResults[h].Name=b.Name,i.tree.Objectives[f].KeyResults[h].Body=b.Body,i.tree.Objectives[f].KeyResults[h].Priority=b.Priority,i.tree.Objectives[f].KeyResults[h].Completed=b.Completed
}else{var j=g(i.currentKeyResult.Tasks,b.Id);i.currentKeyResult.Tasks[j].Name=b.Name,i.currentKeyResult.Tasks[j].Body=b.Body,i.currentKeyResult.Tasks[j].Priority=b.Priority,i.currentKeyResult.Tasks[j].Completed=b.Completed}}else"Objective"===d?(b.KeyResults=[],i.tree.Objectives.push(b)):"Key Result"===d?(b.Tasks=[],i.currentObjective.KeyResults.push(b)):i.currentKeyResult.Tasks.push(b)}})},h()}var b=angular.module("TreeModule");a.$inject=["$scope","$mdDialog","TreeFactory","$stateParams","$filter"],b.controller("TreeController",a)}(),function(){"use strict";function a(a,b){var c={getTrees:function(c){var d=b.getTreesInOrg+c;return a.get(d)},getSingleTree:function(c,d){var e=b.getSingleTreeInOrg+c+"/"+d;return a.get(e)},createTree:function(c,d){var e=b.createTree+c;return a.post(e,{treeName:d.name,timeframe:d.timeframe,userId:d.userId,username:d.username})},updateMembers:function(c,d){var e=b.updateMembers+c.OrgName;return a.post(e,{updateTree:!0,treeName:c.TreeName,treeId:c.Id,members:d})},createObjective:function(c,d){var e=b.createObjective+c.OrgName;return a.post(e,{id:d.Id,treeId:c.Id,name:d.Name,body:d.Body,completed:!1,members:d.Members})},updateObjective:function(c,d){var e=b.updateObjective+c.OrgName+"/"+c.Id+"/"+d.Id;return a.post(e,{objName:d.Name,objbody:d.Body,completed:d.Completed})},createKeyResult:function(c,d,e){var f=b.createKeyResult+c.OrgName+"/"+e.Id;return a.post(f,{id:d.Id,treeId:c.Id,name:d.Name,body:d.Body,priority:d.Priority,completed:!1,members:d.Members})},updateKeyResult:function(c,d,e){var f=parseFloat(d.Id[2])-1,g=b.updateKeyResult+c.OrgName+"/"+c.Id+"/"+e.Id+"/"+f;return a.post(g,{krName:d.Name,krbody:d.Body,priority:d.Priority,completed:d.Completed})},createTask:function(c,d,e,f){var g=parseFloat(f.Id[2])-1,h=b.createTask+c.OrgName+"/"+e.Id+"/"+g;return a.post(h,{id:d.Id,treeId:c.Id,name:d.Name,body:d.Body,priority:d.Priority,completed:!1,members:d.Members})},updateTask:function(c,d,e,f){var g=parseFloat(f.Id[2])-1,h=parseFloat(d.Id[4])-1,i=b.updateTask+c.OrgName+"/"+c.Id+"/"+e.Id+"/"+g+"/"+h;return a.post(i,{taskname:d.Name,taskbody:d.Body,priority:d.Priority,completed:d.Completed})},formatTrees:function(a){var b=[],c=[];return _.forEach(a,function(d,e){(e+1)%4===0?(c.push(d),b.push(c),c=[]):c.push(d),e+1===a.length&&b.push(c)}),b}};return c}var b=angular.module("SharedFactories");a.$inject=["$http","okraAPI"],b.factory("TreeFactory",a)}();